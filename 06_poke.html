<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Poke</title>
    <link id="favicon" rel="icon" href="data:," />
    <meta
      property="og:image"
      content="https://static.wikia.nocookie.net/pokemon/images/f/f4/%EC%B9%BC%EB%A1%9C%EC%8A%A4%EB%8F%84%EA%B0%90_%EA%B3%B5%EC%8B%9D_%EC%9D%BC%EB%9F%AC%EC%8A%A4%ED%8A%B8.png/revision/latest?cb=20131003143119&path-prefix=ko"
    />
    <style>
      @font-face {
        font-family: "OngleipParkDahyeon";
        src: url("https://cdn.jsdelivr.net/gh/projectnoonnu/2411-3@1.0/Ownglyph_ParkDaHyun.woff2")
          format("woff2");
        font-weight: normal;
        font-display: swap;
      }
      @import url("https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap");

      body {
        font-family: "OngleipParkDahyeon", sans-serif;
        background-color: #f0f0f0;
        color: #333;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 40px 20px;
        min-height: 100vh;
        box-sizing: border-box;
        text-align: center;
      }

      h1 {
        font-family: "Press Start 2P", cursive;
        color: #ff0000;
        -webkit-text-stroke: 4px #3b4cca;
        font-size: 96px;
        margin-bottom: 30px;
      }

      #controller {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        margin-bottom: 20px;
      }

      #pokeId {
        padding: 10px;
        border: 2px solid #dedede;
        border-radius: 5px;
        font-family: "OngleipParkDahyeon", sans-serif;
        text-align: center;
        width: 100px;
        margin-right: 10px;
        font-size: 1.5em;
      }

      #pokeBtn {
        padding: 12px 20px;
        border: none;
        border-radius: 5px;
        background-color: #ff0000;
        color: white;
        font-family: "OngleipParkDahyeon", sans-serif;
        cursor: pointer;
        transition: background-color 0.2s;
        font-size: 1.5em;
      }

      #pokeBtn:hover {
        background-color: #cc0000;
      }

      #pokeBox {
        width: 320px;
        background: #fff;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        border: 5px solid #ffcb05;
        padding: 20px;
        margin-top: 20px;
        text-align: center;
        visibility: hidden;
        opacity: 0;
        transform: scale(0.9);
        transition: opacity 0.4s ease-out, transform 0.4s ease-out,
          visibility 0.4s;
      }

      #pokeBox.visible {
        visibility: visible;
        opacity: 1;
        transform: scale(1);
      }

      #pokeBox img {
        width: 90%;
        image-rendering: auto; /* Changed from pixelated for the new style */
        background-color: #f8f8f8;
        border: 3px solid #dedede;
        border-radius: 5px;
        margin-top: 10px;
      }

      #pokeBox h4 {
        margin: 15px 0 5px;
        font-size: 2.5em;
        color: black;
      }

      #pokeBox h5 {
        margin: 0 0 15px;
        font-size: 1.2em;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      audio {
        width: 90%;
        margin-top: 15px;
      }
    </style>
  </head>
  <body>
    <h1>Pokédex</h1>
    <section id="controller">
      <input id="pokeId" type="number" min="1" placeholder="ID" />
      <button id="pokeBtn">검색</button>
    </section>
    <section id="pokeBox"></section>

    <script>
      // 1. API에서 데이터 호출하기
      async function getPokemon(id) {
        if (!id) {
          alert("포켓몬 ID를 입력해주세요!");
          return;
        }
        if (isNaN(id)) {
          alert("숫자를 입력해주세요.");
          return;
        }
        console.log(`${id}번 포켓몬을 불러옵니다.`);
        try {
          const response = await fetch(
            `https://pokeapi.co/api/v2/pokemon/${id}`
          );
          if (!response.ok) {
            throw new Error("해당 ID의 포켓몬을 찾을 수 없습니다.");
          }
          const data = await response.json();

          const response2 = await fetch(
            `https://pokeapi.co/api/v2/pokemon-species/${id}`
          );
          if (!response2.ok) {
            throw new Error("해당 ID의 포켓몬 종 정보를 찾을 수 없습니다.");
          }
          const data2 = await response2.json();

          const koNameObj = data2.names.find((v) => v.language.name === "ko");
          const koName = koNameObj ? koNameObj.name : data.name;

          const poke = {
            engName: data.name,
            koName,
            shape: data.sprites.front_default,
            sound: data.cries.latest,
          };
          localStorage.setItem("recent", JSON.stringify(poke)); // 문자열화
          renderPoke(poke);
        } catch (error) {
          alert(error.message);
          console.error(error);
        }
      }

      // 2. input 통해 번호 바꿔보기
      const pokeBtn = document.querySelector("#pokeBtn");
      const pokeId = document.querySelector("#pokeId");
      pokeBtn.addEventListener("click", () => getPokemon(pokeId.value));
      pokeId.addEventListener("keyup", (event) => {
        if (event.key === "Enter") {
          getPokemon(pokeId.value);
        }
      });

      // 3. 데이터 화면에 그리기
      function renderPoke({ engName, koName, shape, sound }) {
        document.querySelector("#favicon").href = shape;
        const pokeBox = document.querySelector("#pokeBox");
        pokeBox.innerHTML = `
            <h4>${koName}</h4>
            <h5>${engName}</h5>
            <img src="${shape}" alt="${koName}">
            <audio src="${sound}" controls></audio>
        `;
        pokeBox.classList.add("visible");
      }

      // 4. 직전 검색 데이터를 Storage 자동 로딩
      document.addEventListener("DOMContentLoaded", () => {
        const rawRecenPoke = localStorage.getItem("recent"); // 문자열
        if (!rawRecenPoke) return; // 빈 문자열이나 undefined -> 무시하고 넘어가기
        const recentPoke = JSON.parse(rawRecenPoke);
        renderPoke(recentPoke);
        pokeId.value = JSON.parse(rawRecenPoke).id || "";
      });
    </script>
  </body>
</html>
